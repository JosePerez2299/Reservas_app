{% extends "template.html" %}

{% block contenido %}
  <h2>Lista de Espacios</h2>
  <form method="get">
    <!-- Buscar texto -->
    <div>
      <label for="id_q">Buscar</label>
      <input type="text" id="id_q" name="q" value="{{ q }}" placeholder="Nombre u ubicación…">
    </div>

    <!-- Disponibilidad -->
    <div>
      <label for="id_available">Disponibilidad</label>
      <select id="id_available" name="available">
        <option value="all" {% if available == 'all' %}selected{% endif %}>Todos</option>
        <option value="yes" {% if available == 'yes' %}selected{% endif %}>Disponibles</option>
        <option value="no" {% if available == 'no' %}selected{% endif %}>No disponibles</option>
      </select>
    </div>

    <!-- Tipo -->
    <div>
      <label for="id_tipo">Tipo</label>
      <select id="id_tipo" name="tipo">
        <option value="all" {% if tipo == 'all' %}selected{% endif %}>Todos</option>
        {% for value, label in tipos %}
          <option value="{{ value }}" {% if tipo == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Capacidad mínima -->
    <div>
      <label for="id_cap_min">Capacidad min.</label>
      <input type="number" id="id_cap_min" name="cap_min" value="{{ cap_min }}" min="0">
    </div>

    <!-- Capacidad máxima -->
    <div>
      <label for="id_cap_max">Capacidad max.</label>
      <input type="number" id="id_cap_max" name="cap_max" value="{{ cap_max }}" min="0">
    </div>
    
    <!-- Botones -->
    <div>
      <button type="submit">Filtrar</button>
      <a href="{% url 'espacio_list' %}">Limpiar</a>
    </div>
  </form>

  <table>
    
<thead>
  <tr>
    <th><a href="?q={{ q }}&available={{ available }}&tipo={{ tipo }}&cap_min={{ cap_min }}&cap_max={{ cap_max }}&sort={% if sort == 'nombre' %}-nombre{% else %}nombre{% endif %}">Nombre</a></th>
    <th><a href="?q={{ q }}&available={{ available }}&tipo={{ tipo }}&cap_min={{ cap_min }}&cap_max={{ cap_max }}&sort={% if sort == 'ubicacion' %}-ubicacion{% else %}ubicacion{% endif %}">Ubicación</a></th>
    <th><a href="?q={{ q }}&available={{ available }}&tipo={{ tipo }}&cap_min={{ cap_min }}&cap_max={{ cap_max }}&sort={% if sort == 'capacidad' %}-capacidad{% else %}capacidad{% endif %}">Capacidad</a></th>
    <th>Tipo</th>
    <th>Disponible</th>
    <th>Acciones</th>
  </tr>
</thead>
    <tbody>
      {% for espacio in espacios %}
        <tr>
          <td>{{ espacio.nombre }}</td>
          <td>{{ espacio.ubicacion }}</td>
          <td>{{ espacio.capacidad }}</td>
          <td>{{ espacio.get_tipo_display }}</td>
          <td>{% if espacio.disponible %}Sí{% else %}No{% endif %}</td>
          <td>
            <a href="{% url 'espacio_edit' espacio.pk %}">Editar</a>
            <a href="{% url 'espacio_delete' espacio.pk %}">Eliminar</a>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="6">No hay espacios.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

<!-- Paginación -->
<div>
  <nav>
    <ul>
      {% if espacios.has_previous %}
        <li>
          <a href="?q={{ q }}&available={{ available }}&tipo={{ tipo }}&cap_min={{ cap_min }}&cap_max={{ cap_max }}&sort={{ sort }}&page={{ espacios.previous_page_number }}">Anterior</a>
        </li>
      {% endif %}
      {% for num in espacios.paginator.page_range %}
        {% if espacios.number == num %}
          <li><span>{{ num }}</span></li>
        {% else %}
          <li>
            <a href="?q={{ q }}&available={{ available }}&tipo={{ tipo }}&cap_min={{ cap_min }}&cap_max={{ cap_max }}&sort={{ sort }}&page={{ num }}">{{ num }}</a>
          </li>
        {% endif %}
      {% endfor %}
      {% if espacios.has_next %}
        <li>
          <a href="?q={{ q }}&available={{ available }}&tipo={{ tipo }}&cap_min={{ cap_min }}&cap_max={{ cap_max }}&sort={{ sort }}&page={{ espacios.next_page_number }}">Siguiente</a>
        </li>
      {% endif %}
    </ul>
  </nav>
</div>

{% endblock %}
