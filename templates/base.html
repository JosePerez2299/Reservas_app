{% load compress %} {% load static %}

<!DOCTYPE html>
<html lang="en" x-data="themeSwitcher()" x-init="init()" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reservas CANTV</title>
    {% compress css %}
    <link rel="stylesheet" href="{% static 'src/css/output.css' %}" />
    {% endcompress %}
  </head>

  <body class="flex flex-col min-h-screen bg-base-100">
  <div class="flex flex-col min-h-screen">
    <div class="flex-grow">
    <div class="drawer flex flex-col min-h-screen">
      <input id="my-drawer-3" type="checkbox" class="drawer-toggle" />
      <div class="drawer-content flex flex-col flex-grow">
        <!-- Navbar -->
        <div class="navbar bg-base-200 w-full">
          <div class="flex-none lg:hidden">
            <label for="my-drawer-3" aria-label="open sidebar" class="btn btn-square btn-ghost">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block h-6 w-6 stroke-current">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
              </svg>
            </label>
          </div>
          <div class="mx-2 flex-1 px-2">
            <div class="flex gap-2 items-center">
              <a href="{% url 'dashboard' %}" class="inline-block transition-transform duration-300 hover:scale-110">{% include 'includes/logo.html' %}</a>
              <div class="hidden lg:flex divider divider-horizontal"></div>
              <p class="text-base-content text-sm hidden lg:block">Panel de <span class="font-bold">{{ group }}</span> / <span class="font-bold text-primary text-shadow-accent-content">{{ request.user.username }}</span></p>
            </div>
          </div>
          <div class="hidden flex-none lg:block">
            <ul class="menu menu-horizontal">
              {% if request.user.is_authenticated %}
                <li>
                  <a href="{% url 'dashboard' %}">Inicio</a>
                </li>

                {# Dropdowns por cada modelo con permisos #}
                {% for model, perms in dashboard_access.items %}
                  <li>
                    <a href="{% url model %}">{{ model|capfirst }}s</a>
                  </li>
                {% endfor %}

                {# Cerrar sesión #}
                <li>
                  <form method="post" action="{% url 'logout' %}">
                    {% csrf_token %}
                    <button type="submit">Cerrar sesión</button>
                </form>
                </li>
              {% else %}
                {# Si no está autenticado, sólo “Iniciar sesión” #}
                <li>
                  <a href="{% url 'login' %}">Iniciar sesión</a>
                </li>
              {% endif %}
                <li>
                  {% include 'includes/switch_theme.html' %}
                </li>
            </ul>
          </div>
        </div>
        <!-- Page content here -->
        <div class="h-[calc(100vh-4rem)]"> 
          {% block content %}

          {% endblock %}
        </div>

      </div>



      <!-- Sidebar -->
      <div class="drawer-side">
        <label for="my-drawer-3" aria-label="close sidebar" class="drawer-overlay"></label>

        <ul class="menu bg-base-200 min-h-full w-80 p-4">
          <li class="menu-title text-base-content">
            <p>Panel de <span class="font-bold">{{ group }}</span> / <span class="font-bold">{{ request.user.username }}</span></p>
          </li>
          <div class="divider"></div>
          <!-- Sidebar content here -->
          {% if request.user.is_authenticated %}
            <li>
              <a href="{% url 'dashboard' %}">Inicio</a>
            </li>

            {# Dropdowns por cada modelo con permisos #}
            {% for model, perms in dashboard_access.items %}
              <li>
                <a href="{% url model %}">{{ model|capfirst }}s</a>
              </li>
            {% endfor %}

            {# Cerrar sesión #}
            <li>
              <a url="{% url 'logout' %}">Cerrar sesión</a>
            </li>
          {% else %}
            <li>
              <a href="{% url 'login' %}">Iniciar sesión</a>
            </li>
          {% endif %}
          <li>
            {% include 'includes/switch_theme.html' %}
          </li>
        </ul>
      </div>
      
    </div>
    <footer class="footer sm:footer-horizontal bg-base-200 text-base-content p-10">
      <aside>
        <svg
          width="50"
          height="50"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
          fill-rule="evenodd"
          clip-rule="evenodd"
          class="fill-current">
          <path
            d="M22.672 15.226l-2.432.811.841 2.515c.33 1.019-.209 2.127-1.23 2.456-1.15.325-2.148-.321-2.463-1.226l-.84-2.518-5.013 1.677.84 2.517c.391 1.203-.434 2.542-1.831 2.542-.88 0-1.601-.564-1.86-1.314l-.842-2.516-2.431.809c-1.135.328-2.145-.317-2.463-1.229-.329-1.018.211-2.127 1.231-2.456l2.432-.809-1.621-4.823-2.432.808c-1.355.384-2.558-.59-2.558-1.839 0-.817.509-1.582 1.327-1.846l2.433-.809-.842-2.515c-.33-1.02.211-2.129 1.232-2.458 1.02-.329 2.13.209 2.461 1.229l.842 2.515 5.011-1.677-.839-2.517c-.403-1.238.484-2.553 1.843-2.553.819 0 1.585.509 1.85 1.326l.841 2.517 2.431-.81c1.02-.33 2.131.211 2.461 1.229.332 1.018-.21 2.126-1.23 2.456l-2.433.809 1.622 4.823 2.433-.809c1.242-.401 2.557.484 2.557 1.838 0 .819-.51 1.583-1.328 1.847m-8.992-6.428l-5.01 1.675 1.619 4.828 5.011-1.674-1.62-4.829z"></path>
        </svg>
        <p>
          ACME Industries Ltd.
          <br />
          Providing reliable tech since 1992
        </p>
      </aside>
      <nav>
        <h6 class="footer-title">Services</h6>
        <a class="link link-hover">Branding</a>
        <a class="link link-hover">Design</a>
        <a class="link link-hover">Marketing</a>
        <a class="link link-hover">Advertisement</a>
      </nav>
      <nav>
        <h6 class="footer-title">Company</h6>
        <a class="link link-hover">About us</a>
        <a class="link link-hover">Contact</a>
        <a class="link link-hover">Jobs</a>
        <a class="link link-hover">Press kit</a>
      </nav>
      <nav>
        <h6 class="footer-title">Legal</h6>
        <a class="link link-hover">Terms of use</a>
        <a class="link link-hover">Privacy policy</a>
        <a class="link link-hover">Cookie policy</a>
      </nav>
    </footer>
  </div>

  <script>
      function themeSwitcher() {
        return {
          // usamos booleano para simplificar el binding con el checkbox
          dark: localStorage.getItem('theme') === 'dark',
      
          init() {
            // al iniciar, aplicamos el tema según localStorage o preferencia del sistema
            this.applyTheme(this.dark)
          },
      
          toggle() {
            // invocado al hacer click sobre el swap
            this.dark = !this.dark
            this.applyTheme(this.dark)
          },
      
          applyTheme(isDark) {
            // ponemos el atributo data-theme que DaisyUI utiliza
            document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light')
            // guardamos la preferencia
            localStorage.setItem('theme', isDark ? 'dark' : 'light')
          }
        }
      }
    </script>

    <!-- Alpine Plugins -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/focus@3.x.x/dist/cdn.min.js"></script>

    <!-- Alpine Core -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  </body>
</html>
