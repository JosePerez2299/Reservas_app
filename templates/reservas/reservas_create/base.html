<div class='p-7' >
    <!-- Header -->
    <div class="text-center mb-8">
        <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mb-4 shadow-lg">
            <i class="fas fa-calendar-alt text-2xl text-white"></i>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Reserva de Espacios</h1>
        <p class="text-gray-600">Sistema integral de gestión de reservas</p>
    </div>

    <!-- Progreso Visual -->
    <div id="progress" class="mb-8">
        <div class="flex items-center justify-center space-x-4">
            <!-- Paso 1 -->
            <div class="flex items-center">
                <div class="w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold bg-gray-300 text-gray-600" id="step-1">1</div>
                <span class="ml-3 text-sm font-medium text-gray-500" id="step-1-text">Tipo de Espacio</span>
            </div>
            <div class="w-16 h-px bg-gray-300" id="progress-line-1"></div>
            <!-- Paso 2 -->
            <div class="flex items-center">
                <div class="w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold bg-gray-300 text-gray-600" id="step-2">2</div>
                <span class="ml-3 text-sm font-medium text-gray-500" id="step-2-text">Detalles</span>
            </div>
            <div class="w-16 h-px bg-gray-300" id="progress-line-2"></div>
            <!-- Paso 3 -->
            <div class="flex items-center">
                <div class="w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold bg-gray-300 text-gray-600" id="step-3">3</div>
                <span class="ml-3 text-sm font-medium text-gray-500" id="step-3-text">Confirmación</span>
            </div>
        </div>
    </div>

    <!-- Contenedor dinámico -->
    <div id="wizard-container"
         hx-get="{% url 'reserva_create_step1' %}"
         hx-trigger="load">
        <!-- Spinner inicial -->
        <div class="flex flex-col items-center justify-center py-12 space-y-4">
            <span class="loading loading-spinner loading-lg text-primary"></span>
            <p class="text-base-content/70">Cargando formulario...</p>
        </div>
    </div>
</div>

<!-- Script progreso y spinner -->
<script>
// Función para mostrar el spinner en el wizard
function showWizardSpinner() {
    const wizardContainer = document.getElementById('wizard-container');
    wizardContainer.innerHTML = `
        <div class="flex flex-col items-center justify-center py-12 space-y-4">
            <span class="loading loading-spinner loading-lg text-primary"></span>
            <p class="text-base-content/70">Cargando...</p>
        </div>
    `;
}

// Evento antes de hacer la petición HTMX - mostrar spinner
document.body.addEventListener("htmx:beforeRequest", function(evt) {
    if (evt.target.id === "wizard-container" || evt.target.closest("#wizard-container")) {
        showWizardSpinner();
    }
});

// Evento después del intercambio - actualizar progreso
document.body.addEventListener("htmx:afterSwap", function(evt) {
    if (evt.target.id === "wizard-container") {
        const stepDiv = evt.target.querySelector("[data-step]");
        if (stepDiv) {
            updateProgress(parseInt(stepDiv.dataset.step));
        }
    }
});

// Manejar errores de carga en el wizard
document.body.addEventListener("htmx:responseError", function(evt) {
    if (evt.target.id === "wizard-container") {
        const wizardContainer = document.getElementById('wizard-container');
        wizardContainer.innerHTML = `
            <div class="flex flex-col items-center justify-center py-12 space-y-4">
                <div class="text-error text-6xl">⚠️</div>
                <p class="text-error font-semibold">Error al cargar el contenido</p>
                <button class="btn btn-sm btn-outline" onclick="location.reload()">Reintentar</button>
            </div>
        `;
    }
});

// Manejar problemas de conexión en el wizard
document.body.addEventListener("htmx:sendError", function(evt) {
    if (evt.target.id === "wizard-container") {
        const wizardContainer = document.getElementById('wizard-container');
        wizardContainer.innerHTML = `
            <div class="flex flex-col items-center justify-center py-12 space-y-4">
                <div class="text-warning text-6xl">🌐</div>
                <p class="text-warning font-semibold">Sin conexión a internet</p>
                <button class="btn btn-sm btn-outline" onclick="location.reload()">Reintentar</button>
            </div>
        `;
    }
});

function updateProgress(step) {
    // reset círculos y textos
    ["1","2","3"].forEach(n => {
        document.getElementById("step-"+n).className =
            "w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold bg-gray-300 text-gray-600";
        document.getElementById("step-"+n+"-text").className =
            "ml-3 text-sm font-medium text-gray-500";
    });
    // reset líneas
    ["1","2"].forEach(n => {
        document.getElementById("progress-line-"+n).className = "w-16 h-px bg-gray-300";
    });

    // marcar pasos previos como completados
    for (let i=1; i<step; i++) {
        setDone(i);
        if (document.getElementById("progress-line-"+i)) {
            document.getElementById("progress-line-"+i).className = "w-16 h-px bg-green-500";
        }
    }
    // marcar activo
    setActive(step);
}

function setActive(n) {
    document.getElementById("step-"+n).className =
        "w-10 h-10 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold";
    document.getElementById("step-"+n+"-text").className =
        "ml-3 text-sm font-medium text-blue-600";
}

function setDone(n) {
    document.getElementById("step-"+n).className =
        "w-10 h-10 bg-green-500 text-white rounded-full flex items-center justify-center text-sm font-bold";
    document.getElementById("step-"+n+"-text").className =
        "ml-3 text-sm font-medium text-green-600";
}
</script>
