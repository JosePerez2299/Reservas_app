{% load crispy_forms_tags %}
{% load widget_tweaks %}  {# asegúrate de tener django-widget-tweaks instalado #}
<div class="bg-base-200 rounded-lg p-4 border border-base-300">
  <div class="flex items-center gap-2 mb-3">
    <i class="fas fa-edit text-primary text-sm"></i>
    <h3 class="font-medium text-sm">{{ title }}</h3>
  </div>
  <form
    class="flex flex-wrap gap-4"
    method="POST"
    hx-post="{{ url }}"
    hx-target="#generic_modal_content"
    hx-swap="innerHTML"
  >
    {% csrf_token %}
    
    {% comment %}Mostrar errores no relacionados con campos específicos{% endcomment %}
    {% if form.non_field_errors %}
      <div class="w-full">
        {% for error in form.non_field_errors %}
          <div class="alert alert-error mb-2">
            <i class="fas fa-exclamation-circle"></i>
            <span>{{ error }}</span>
          </div>
        {% endfor %}
      </div>
    {% endif %}
    
    {% for field in form %}
      {% comment %}
      Usar atributos separados para fieldset y widget
      fieldset_class: para las clases del contenedor fieldset
      class: para las clases del input/widget
      Agregar clases especiales para campos disabled
      {% endcomment %}
      {% with fieldset_classes=field.field.widget.attrs.fieldset_class|default:"w-full" %}
        {% if field.field.disabled %}
          <fieldset class="{{ fieldset_classes }} opacity-60 bg-base-300/20 rounded-lg border border-base-300/50 p-2">
            <legend class="label-text font-medium text-sm mb-1 text-base-content/60">
              {{ field.label }} 
              {% if field.field.required %}<span class="text-error">*</span>{% endif %}
              <span class="text-xs text-base-content/50 ml-1">(deshabilitado)</span>
            </legend>
            
            {% for error in field.errors %}
              <p class="text-sm text-error">{{ error }}</p>
            {% endfor %}
          </fieldset>
        {% else %}
          <fieldset class="{{ fieldset_classes }}">
            <legend class="label-text font-medium text-sm mb-1">{{ field.label }} {% if field.field.required %}<span class="text-error">*</span>{% endif %}</legend>
            {{ field }}
            {% for error in field.errors %}
              <p class="text-sm text-error">{{ error }}</p>
            {% endfor %}
          </fieldset>
        {% endif %}
      {% endwith %}
    {% endfor %}
    <button type="submit" class="btn btn-primary">Guardar</button>
  </form>
</div>