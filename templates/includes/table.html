{% load model_extras %}
{% load querystring %}
{% load widget_tweaks %}
{% load form_style %}


  {# Este template debe ser incluido en un ListView, para poder acceder a: #}
  {# - object_list: lista de objetos que se van a mostrar en la tabla #}
  {# - model: el modelo de Django que se va a mostrar en la tabla #}
  {# - view: la vista que se encarga de mostrar la tabla #}

<div>
  {# —————— TABLA DE RESULTADOS —————— #}
  <div class="overflow-x-auto">
    <table class="table table-zebra w-full">
      {# table.html #}
      <thead class="bg-base-300">
        <tr>
          {% for field, label in cols.items %}
            <th class="text-center">
              {% comment %}
                Si ya estamos ordenados por este campo en ascendente,
                el click invierte a descendente y mostramos ▲
              {% endcomment %}
              {% if request.GET.ordering == field %}
                <a href="?{% query_transform request ordering='-'|add:field %}" class="hover:underline">
                  {{ label }} ▲
                </a>
      
              {% comment %}
                Si ya estamos en descendente, volvemos a asc y mostramos ▼
              {% endcomment %}
              {% elif request.GET.ordering == '-'|add:field %}
                <a href="?{% query_transform request ordering=field %}" class="hover:underline">
                  {{ label }} ▼
                </a>
      
              {% comment %}
                En cualquier otro caso, ordenamos ascendente
              {% endcomment %}
              {% else %}
                <a href="?{% query_transform request ordering=field %}" class="hover:underline">
                  {{ label }}
                </a>
              {% endif %}
            </th>
          {% endfor %}
          <th class="text-center">Acción</th>
        </tr>
      </thead>
      

      
      <tbody>
        {% for obj in object_list %}
          <tr>
            {% for col in cols %}
              <td class="text-center">
                {% with value=obj|get_attr:col %}
                  {% if value is True %}
                    <div class="inline-grid *:[grid-area:1/1]">
                      <div class="status status-success animate-ping"></div>
                      <div class="status status-success"></div>
                    </div>  
                    <span>Si</span>
                  {% elif value is False %}
                    <div class="inline-grid *:[grid-area:1/1]">
                      <div class="status status-error animate-ping"></div>
                      <div class="status status-error"></div>
                    </div>
                    <span>No</span>
                  
                  {% elif value == 'pendiente' %}
                  <div class="text-xs badge badge-dash badge-warning">Pendiente</div>
                  {% elif value == 'aprobada' %}
                  <div class="text-xs badge badge-dash badge-success">Aprobada</div>
                  {% elif value == 'rechazada' %}
                  <div class="text-xs badge badge-dash badge-error">Rechazada</div>
                  {% else %}
                    {{ value }}
                  {% endif %}
                {% endwith %}
              </td>
          {% endfor %}
            <!-- Celda de acciones -->

          {% block actions %}
          {% endblock %}

          </tr>
        {% empty %}
          <tr>
            <td colspan="{{ cols|length|add:'1' }}" class="text-center">
              No se encontraron resultados.
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {# ————————————————————————————— #}

  {# —————— PAGINACIÓN —————— #}
  <div class="join justify-center mt-4">
    {% if page_obj %}
      {% if page_obj.has_previous %}
        <a href="?{% query_transform request page=1 %}" class="join-item btn btn-sm">«</a>
        <a href="?{% query_transform request page=page_obj.previous_page_number %}" class="join-item btn btn-sm">‹</a>
      {% else %}
        <a href="#" class="join-item btn btn-sm btn-disabled">«</a>
        <a href="#" class="join-item btn btn-sm btn-disabled">‹</a>
      {% endif %}

      {% if page_obj.number > 4 %}
        <a href="?{% query_transform request page=1 %}" class="join-item btn btn-sm">1</a>
        <span class="join-item btn btn-sm btn-disabled">…</span>
      {% endif %}

      {% for num in page_obj.paginator.page_range %}
        {% if num >= page_obj.number|add:'-2' and num <= page_obj.number|add:'2' %}
          {% if num == page_obj.number %}
            <a href="#" class="join-item btn btn-sm btn-active">{{ num }}</a>
          {% else %}
            <a href="?{% query_transform request page=num %}" class="join-item btn btn-sm">{{ num }}</a>
          {% endif %}
        {% endif %}
      {% endfor %}

      {% if page_obj.number < page_obj.paginator.num_pages|add:'-3' %}
        <span class="join-item btn btn-sm btn-disabled">…</span>
        <a href="?{% query_transform request page=page_obj.paginator.num_pages %}" class="join-item btn btn-sm">{{ page_obj.paginator.num_pages }}</a>
      {% endif %}

      {% if page_obj.has_next %}
        <a href="?{% query_transform request page=page_obj.next_page_number %}" class="join-item btn btn-sm">›</a>
        <a href="?{% query_transform request page=page_obj.paginator.num_pages %}" class="join-item btn btn-sm">»</a>
      {% else %}
        <a href="#" class="join-item btn btn-sm btn-disabled">›</a>
        <a href="#" class="join-item btn btn-sm btn-disabled">»</a>
      {% endif %}
    {% endif %}
  </div>
  {# ————————————————————————————— #}

</div>
